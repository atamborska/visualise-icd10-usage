<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.555">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Arina Tamborska">

<title>ICD-10 Usage in NHS Englad Hospital Episode Statistics (2013-2023)</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="icd10_files/libs/clipboard/clipboard.min.js"></script>
<script src="icd10_files/libs/quarto-html/quarto.js"></script>
<script src="icd10_files/libs/quarto-html/popper.min.js"></script>
<script src="icd10_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="icd10_files/libs/quarto-html/anchor.min.js"></script>
<link href="icd10_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="icd10_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="icd10_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="icd10_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="icd10_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="icd10_files/libs/core-js-2.5.3/shim.min.js"></script>

<script src="icd10_files/libs/react-18.2.0/react.min.js"></script>

<script src="icd10_files/libs/react-18.2.0/react-dom.min.js"></script>

<script src="icd10_files/libs/reactwidget-2.0.0/react-tools.umd.cjs"></script>

<script src="icd10_files/libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>

<link href="icd10_files/libs/reactable-0.4.4/reactable.css" rel="stylesheet">

<script src="icd10_files/libs/reactable-binding-0.4.4/reactable.js"></script>

<link href="icd10_files/libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet">

<script src="icd10_files/libs/pagedtable-1.1/js/pagedtable.js"></script>



</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">ICD-10 Usage in NHS Englad Hospital Episode Statistics (2013-2023)</h1>
<p class="subtitle lead">Examination of pregnancy code usage and development of a visualisation tool</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Arina Tamborska </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>opts_chunk<span class="sc">$</span><span class="fu">set</span>(<span class="at">message=</span> <span class="cn">FALSE</span>, <span class="at">warning =</span> <span class="cn">FALSE</span>, <span class="at">echo =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>This document downloads, processes, and visualizes the annual usage of ICD-10 codes from Hospital Episode Statistics: records of individual hospital admissions from the NHS England.</p>
</section>
<section id="methods" class="level1">
<h1>Methods</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Load libraries</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(readxl)) <span class="fu">install.packages</span>(<span class="st">"readxl"</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(forcats)) <span class="fu">install.packages</span>(<span class="st">"forcats"</span>)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span> (gt)) <span class="fu">install.packages</span>(<span class="st">"gt"</span>)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(shiny)) <span class="fu">install.packages</span> (<span class="st">"shiny"</span>)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(reticulate)) <span class="fu">install.packages</span>(<span class="st">"reticulate"</span>)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(janitor)</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span> (readxl)</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(forcats)</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gt)</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(shiny)</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(reticulate)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The data are publicly available as xlsx files here: <a href="https://digital.nhs.uk/data-and-information/publications/statistical/hospital-admitted-patient-care-activity" class="uri">https://digital.nhs.uk/data-and-information/publications/statistical/hospital-admitted-patient-care-activity</a>.</p>
<p>We elected to visualise total usage (for all diagnoses recorded in completed consultant episodes) of four letter ICD-10 codes.</p>
<p>All files between 2013 and 2023 were individually downloaded and inspected. To be processed, they met the following criteria:</p>
<ul>
<li><p>all diagnosis four letter code are in tab 6</p></li>
<li><p>the usage counts start no earlier than row 11</p></li>
<li><p>columns A, B and H (1, 2 and 8) correspond to code, diagnosis, and usage</p></li>
</ul>
<p>There were exceptions:</p>
<ul>
<li><p>2020 - 2017 usage count starts in row 12</p></li>
<li><p>2016, 2015 usage count starts in row 13</p></li>
<li><p>2014 - count starts in row 19, counts in column C</p></li>
<li><p>2013 - count starts in row 20, counts in column C</p></li>
<li><p>2012 - earlier: there are just primary diagnosis labels, no all diagnosis. Therefore the data from 2012 and earlier are not included in this report.</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a list of urls with years assigned to them, because of different formatting, create 2015 - 2023, and 2013-2014 separately</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>icd10_usage_urls_2015_2023<span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"2023-09-01"</span> <span class="ot">=</span> <span class="st">"https://files.digital.nhs.uk/7A/DB1B00/hosp-epis-stat-admi-diag-2022-23-tab_V2.xlsx"</span>,</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"2022-09-01"</span> <span class="ot">=</span> <span class="st">"https://files.digital.nhs.uk/0E/E70963/hosp-epis-stat-admi-diag-2021-22-tab.xlsx"</span>,</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">"2021-09-01"</span> <span class="ot">=</span> <span class="st">"https://files.digital.nhs.uk/5B/AD892C/hosp-epis-stat-admi-diag-2020-21-tab.xlsx"</span>,</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">"2020-09-01"</span> <span class="ot">=</span> <span class="st">"https://files.digital.nhs.uk/37/8D9781/hosp-epis-stat-admi-diag-2019-20-tab%20supp.xlsx"</span>,</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">"2019-09-01"</span> <span class="ot">=</span> <span class="st">"https://files.digital.nhs.uk/1C/B2AD9B/hosp-epis-stat-admi-diag-2018-19-tab.xlsx"</span>,</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">"2018-09-01"</span> <span class="ot">=</span> <span class="st">"https://files.digital.nhs.uk/B2/5CEC8D/hosp-epis-stat-admi-diag-2017-18-tab.xlsx"</span>,</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>  <span class="st">"2017-09-01"</span> <span class="ot">=</span> <span class="st">"https://files.digital.nhs.uk/publication/7/d/hosp-epis-stat-admi-diag-2016-17-tab.xlsx"</span>,</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>  <span class="st">"2016-09-01"</span> <span class="ot">=</span> <span class="st">"https://files.digital.nhs.uk/publicationimport/pub22xxx/pub22378/hosp-epis-stat-admi-diag-2015-16-tab.xlsx"</span>,</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>  <span class="st">"2015-09-01"</span> <span class="ot">=</span> <span class="st">"https://files.digital.nhs.uk/publicationimport/pub19xxx/pub19124/hosp-epis-stat-admi-diag-2014-15-tab.xlsx"</span>)</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>icd10_usage_urls_2013_2014 <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>  <span class="st">"2014-09-01"</span> <span class="ot">=</span> <span class="st">"https://files.digital.nhs.uk/publicationimport/pub16xxx/pub16719/hosp-epis-stat-admi-diag-2013-14-tab.xlsx"</span>,</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>  <span class="st">"2013-09-01"</span> <span class="ot">=</span> <span class="st">"https://files.digital.nhs.uk/publicationimport/pub12xxx/pub12566/hosp-epis-stat-admi-diag-2012-13-tab.xlsx"</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>df_2015_2023 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (url <span class="cf">in</span> icd10_usage_urls_2015_2023) {</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">download.file</span>(url, <span class="at">destfile =</span> <span class="st">"tmp.xlsx"</span>, <span class="at">mode =</span> <span class="st">"wb"</span>)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># read in sheet 6 (all four letter diagnoses)</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">"tmp.xlsx"</span>, <span class="at">sheet =</span> <span class="dv">6</span>, <span class="at">col_names =</span> T, <span class="at">skip =</span> <span class="dv">10</span>)</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">file.remove</span>(<span class="st">"tmp.xlsx"</span>)</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># keep cols A (=code), B (=diagnosis), H (=usage)</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> df[, <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">8</span>)]</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(df) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"code"</span>, <span class="st">"diagnosis"</span>, <span class="st">"use"</span>)</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>  df<span class="sc">$</span>use<span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(df<span class="sc">$</span>use)</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Create an index to assign a year</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>  index <span class="ot">&lt;-</span> <span class="fu">which</span>(</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sapply</span>(</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>      icd10_usage_urls_2015_2023, <span class="cf">function</span>(x) url <span class="sc">%in%</span> x))</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Process the df: remove NAs use, add prop, add year, remove str .</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> df <span class="sc">|&gt;</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(use)) <span class="sc">|&gt;</span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">prop =</span> use<span class="sc">/</span> <span class="fu">sum</span>(use),</span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">year =</span> <span class="fu">as.Date</span>(<span class="fu">names</span>(icd10_usage_urls_2015_2023)[index]),</span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">code =</span> <span class="fu">str_replace_all</span>(code, <span class="st">"</span><span class="sc">\\</span><span class="st">."</span>, <span class="st">""</span>)</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Bind all dfs together</span></span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>  df_2015_2023 <span class="ot">&lt;-</span> <span class="fu">rbind</span>(df_2015_2023, df)</span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>df_2013_2014 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(icd10_usage_urls_2013_2014)) {</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># extract list object and its name</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  year <span class="ot">&lt;-</span> <span class="fu">names</span>(icd10_usage_urls_2013_2014)[i]</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  url <span class="ot">&lt;-</span> icd10_usage_urls_2013_2014[[i]]</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># download the xlsx</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">download.file</span>(url, <span class="at">destfile =</span> <span class="st">"tmp.xlsx"</span>, <span class="at">mode=</span><span class="st">"wb"</span>)</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">"tmp.xlsx"</span>, <span class="at">sheet =</span> <span class="dv">6</span>, <span class="at">col_names =</span> T, <span class="at">skip =</span> <span class="dv">10</span>)</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">file.remove</span>(<span class="st">"tmp.xlsx"</span>)</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># keep cols A (=code), B (=diagnosis), C (=usage)</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> df[, <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>]</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(df) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"code"</span>, <span class="st">"diagnosis"</span>, <span class="st">"use"</span>)</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>  df<span class="sc">$</span>use<span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(df<span class="sc">$</span>use)</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Process the df: remove NAs use, add prop, add year, remove str .</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> df <span class="sc">|&gt;</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(use)) <span class="sc">|&gt;</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">prop =</span> use<span class="sc">/</span> <span class="fu">sum</span>(use),</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">year =</span> <span class="fu">as.Date</span>(year),</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">code =</span> <span class="fu">str_replace_all</span>(code, <span class="st">"</span><span class="sc">\\</span><span class="st">."</span>, <span class="st">""</span>)</span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Bind all dfs together</span></span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>  df_2013_2014 <span class="ot">&lt;-</span> <span class="fu">rbind</span>(df_2013_2014, df)</span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(df, i, index, url, year)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>df_2013_2023 <span class="ot">&lt;-</span> <span class="fu">rbind</span>(df_2015_2023, df_2013_2014)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> </span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  df_2013_2023 <span class="sc">|&gt;</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">year</span>(year))</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(df, <span class="st">"df.csv"</span>, <span class="at">fileEncoding =</span> <span class="st">"UTF-8"</span>)</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(df_2013_2014, df_2015_2023, icd10_usage_urls_2013_2014, icd10_usage_urls_2015_2023)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="results" class="level1">
<h1>Results</h1>
<section id="visualisation-of-codes-with-largest-usage" class="level2">
<h2 class="anchored" data-anchor-id="visualisation-of-codes-with-largest-usage">Visualisation of codes with largest usage</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Example vis - those contributing more than 1% in at least one year</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Identify codes for these</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>codes_usage_0<span class="fl">.01</span> <span class="ot">&lt;-</span> </span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  df_2013_2023 <span class="sc">|&gt;</span> </span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(prop <span class="sc">&gt;=</span> <span class="fl">0.01</span>)<span class="sc">|&gt;</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(code) <span class="sc">|&gt;</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unique</span>()</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>codes_usage_0<span class="fl">.01</span> <span class="ot">&lt;-</span> codes_usage_0<span class="fl">.01</span><span class="sc">$</span>code</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualise</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a><span class="co"># With codes</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>df_2013_2023 <span class="sc">|&gt;</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(code <span class="sc">%in%</span> codes_usage_0<span class="fl">.01</span>)<span class="sc">|&gt;</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(year, use, <span class="at">colour =</span> code)) <span class="sc">+</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="icd10_files/figure-html/visualise-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># With diagnoses</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>df_2013_2023 <span class="sc">|&gt;</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(code <span class="sc">%in%</span> codes_usage_0<span class="fl">.01</span>)<span class="sc">|&gt;</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(year, use, <span class="at">colour =</span> diagnosis)) <span class="sc">+</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="icd10_files/figure-html/visualise-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="tabular-exploration-of-pregnancy-codes" class="level2">
<h2 class="anchored" data-anchor-id="tabular-exploration-of-pregnancy-codes">Tabular exploration of pregnancy codes</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>pregnancy_codelist_url<span class="ot">&lt;-</span> <span class="st">"https://www.opencodelists.org/codelist/opensafely/pregnancy-icd10-aurum/5a7d8d12/download.csv"</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>pregnancy_codes <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(pregnancy_codelist_url)[,<span class="dv">1</span>]</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>df_pregnancy <span class="ot">&lt;-</span> df <span class="sc">|&gt;</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(code <span class="sc">%in%</span> pregnancy_codes)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>First, we examined the frequency with which the codes appear in the HES.</p>
<p>Between 2012 and 2023, from 550 codes present in the codelist, 448 have appeared at least once. 280 of these appeared across all years, and 68 appeared in all but one year.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Basic investigation into the frequency of pregnancy codes</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>df_pregnancy<span class="sc">$</span>code<span class="sc">|&gt;</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unique</span>() <span class="sc">|&gt;</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">length</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 448</code></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>df_pregnancy <span class="sc">|&gt;</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(code) <span class="sc">|&gt;</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">count =</span> <span class="fu">n</span>()) <span class="sc">|&gt;</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(count) <span class="sc">|&gt;</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">codes =</span> <span class="fu">n</span>())<span class="sc">|&gt;</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(count)) <span class="sc">|&gt;</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="st">"Number of years in which the code is present"</span>, </span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Number of unique codes"</span>) <span class="sc">|&gt;</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>() <span class="sc">|&gt;</span> </span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">opt_interactive</span>(</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">use_highlight =</span> T,</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">use_compact_mode =</span> T,</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    ) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="wmngckvici" class=".gt_table" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#wmngckvici table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#wmngckvici thead, #wmngckvici tbody, #wmngckvici tfoot, #wmngckvici tr, #wmngckvici td, #wmngckvici th {
  border-style: none;
}

#wmngckvici p {
  margin: 0;
  padding: 0;
}

#wmngckvici .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#wmngckvici .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#wmngckvici .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#wmngckvici .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#wmngckvici .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#wmngckvici .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#wmngckvici .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#wmngckvici .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#wmngckvici .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#wmngckvici .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#wmngckvici .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#wmngckvici .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#wmngckvici .gt_spanner_row {
  border-bottom-style: hidden;
}

#wmngckvici .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#wmngckvici .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#wmngckvici .gt_from_md > :first-child {
  margin-top: 0;
}

#wmngckvici .gt_from_md > :last-child {
  margin-bottom: 0;
}

#wmngckvici .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#wmngckvici .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#wmngckvici .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#wmngckvici .gt_row_group_first td {
  border-top-width: 2px;
}

#wmngckvici .gt_row_group_first th {
  border-top-width: 2px;
}

#wmngckvici .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#wmngckvici .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#wmngckvici .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#wmngckvici .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#wmngckvici .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#wmngckvici .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#wmngckvici .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#wmngckvici .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#wmngckvici .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#wmngckvici .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#wmngckvici .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#wmngckvici .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#wmngckvici .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#wmngckvici .gt_left {
  text-align: left;
}

#wmngckvici .gt_center {
  text-align: center;
}

#wmngckvici .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#wmngckvici .gt_font_normal {
  font-weight: normal;
}

#wmngckvici .gt_font_bold {
  font-weight: bold;
}

#wmngckvici .gt_font_italic {
  font-style: italic;
}

#wmngckvici .gt_super {
  font-size: 65%;
}

#wmngckvici .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#wmngckvici .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#wmngckvici .gt_indent_1 {
  text-indent: 5px;
}

#wmngckvici .gt_indent_2 {
  text-indent: 10px;
}

#wmngckvici .gt_indent_3 {
  text-indent: 15px;
}

#wmngckvici .gt_indent_4 {
  text-indent: 20px;
}

#wmngckvici .gt_indent_5 {
  text-indent: 25px;
}

#wmngckvici .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#wmngckvici div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>
<div id="wmngckvici" class="reactable html-widget" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="wmngckvici">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"Number of years in which the code is present":[11,10,9,8,7,6,5,4,3,2,1],"Number of unique codes":[280,68,28,22,10,7,9,7,7,6,4]},"columns":[{"id":"Number of years in which the code is present","name":"Number of years in which the code is present","type":"numeric","minWidth":125,"style":"function(rowInfo, colInfo) {\nconst rowIndex = rowInfo.index + 1\n}","html":true,"align":"right","headerStyle":{"font-weight":"normal"}},{"id":"Number of unique codes","name":"Number of unique codes","type":"numeric","minWidth":125,"style":"function(rowInfo, colInfo) {\nconst rowIndex = rowInfo.index + 1\n}","html":true,"align":"right","headerStyle":{"font-weight":"normal"}}],"defaultPageSize":10,"showPageSizeOptions":false,"pageSizeOptions":[10,25,50,100],"paginationType":"numbers","showPagination":true,"showPageInfo":true,"minRows":1,"highlight":true,"compact":true,"height":"auto","theme":{"color":"#333333","backgroundColor":"#FFFFFF","stripedColor":"rgba(128,128,128,0.05)","style":{"fontFamily":"system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif"},"tableStyle":{"borderTopStyle":"solid","borderTopWidth":"2px","borderTopColor":"#D3D3D3"},"headerStyle":{"borderBottomStyle":"solid","borderBottomWidth":"2px","borderBottomColor":"#D3D3D3"}},"elementId":"wmngckvici","dataKey":"50a3559899d615777225f46c46e863f8"},"children":[]},"class":"reactR_markup"},"evals":["tag.attribs.columns.0.style","tag.attribs.columns.1.style"],"jsHooks":[]}</script>
</div>
</div>
</div>
<p>Next, we examined how the variety (use of distinct codes) and volume varied over time. Notably, despite stable use of the codes, the total volume of pregnancy codes doubled in 2023 and 2024 in comparison with previous years.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>df_pregnancy <span class="sc">|&gt;</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year) <span class="sc">|&gt;</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">count =</span> <span class="fu">n</span>(), <span class="at">volume =</span> <span class="fu">sum</span>(use))<span class="sc">|&gt;</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(year))<span class="sc">|&gt;</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="fu">c</span>(<span class="st">"Year"</span>, <span class="st">"No. of unique codes"</span>, <span class="st">"Total use"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>() <span class="sc">|&gt;</span> </span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">opt_interactive</span>(</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">use_highlight =</span> T,</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">use_compact_mode =</span> T,</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    ) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="rlvcmetfyu" class=".gt_table" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#rlvcmetfyu table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#rlvcmetfyu thead, #rlvcmetfyu tbody, #rlvcmetfyu tfoot, #rlvcmetfyu tr, #rlvcmetfyu td, #rlvcmetfyu th {
  border-style: none;
}

#rlvcmetfyu p {
  margin: 0;
  padding: 0;
}

#rlvcmetfyu .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#rlvcmetfyu .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#rlvcmetfyu .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#rlvcmetfyu .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#rlvcmetfyu .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#rlvcmetfyu .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#rlvcmetfyu .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#rlvcmetfyu .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#rlvcmetfyu .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#rlvcmetfyu .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#rlvcmetfyu .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#rlvcmetfyu .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#rlvcmetfyu .gt_spanner_row {
  border-bottom-style: hidden;
}

#rlvcmetfyu .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#rlvcmetfyu .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#rlvcmetfyu .gt_from_md > :first-child {
  margin-top: 0;
}

#rlvcmetfyu .gt_from_md > :last-child {
  margin-bottom: 0;
}

#rlvcmetfyu .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#rlvcmetfyu .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#rlvcmetfyu .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#rlvcmetfyu .gt_row_group_first td {
  border-top-width: 2px;
}

#rlvcmetfyu .gt_row_group_first th {
  border-top-width: 2px;
}

#rlvcmetfyu .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#rlvcmetfyu .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#rlvcmetfyu .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#rlvcmetfyu .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#rlvcmetfyu .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#rlvcmetfyu .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#rlvcmetfyu .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#rlvcmetfyu .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#rlvcmetfyu .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#rlvcmetfyu .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#rlvcmetfyu .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#rlvcmetfyu .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#rlvcmetfyu .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#rlvcmetfyu .gt_left {
  text-align: left;
}

#rlvcmetfyu .gt_center {
  text-align: center;
}

#rlvcmetfyu .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#rlvcmetfyu .gt_font_normal {
  font-weight: normal;
}

#rlvcmetfyu .gt_font_bold {
  font-weight: bold;
}

#rlvcmetfyu .gt_font_italic {
  font-style: italic;
}

#rlvcmetfyu .gt_super {
  font-size: 65%;
}

#rlvcmetfyu .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#rlvcmetfyu .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#rlvcmetfyu .gt_indent_1 {
  text-indent: 5px;
}

#rlvcmetfyu .gt_indent_2 {
  text-indent: 10px;
}

#rlvcmetfyu .gt_indent_3 {
  text-indent: 15px;
}

#rlvcmetfyu .gt_indent_4 {
  text-indent: 20px;
}

#rlvcmetfyu .gt_indent_5 {
  text-indent: 25px;
}

#rlvcmetfyu .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#rlvcmetfyu div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>
<div id="rlvcmetfyu" class="reactable html-widget" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="rlvcmetfyu">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"Year":[2023,2022,2021,2020,2019,2018,2017,2016,2015,2014,2013],"No. of unique codes":[430,433,395,401,403,399,404,379,380,386,400],"Total use":[4128492,4119569,2046174,2236025,2801795,2870370,2520035,2446371,2051825,2552594,2347764]},"columns":[{"id":"Year","name":"Year","type":"numeric","minWidth":125,"style":"function(rowInfo, colInfo) {\nconst rowIndex = rowInfo.index + 1\n}","html":true,"align":"right","headerStyle":{"font-weight":"normal"}},{"id":"No. of unique codes","name":"No. of unique codes","type":"numeric","minWidth":125,"style":"function(rowInfo, colInfo) {\nconst rowIndex = rowInfo.index + 1\n}","html":true,"align":"right","headerStyle":{"font-weight":"normal"}},{"id":"Total use","name":"Total use","type":"numeric","minWidth":125,"style":"function(rowInfo, colInfo) {\nconst rowIndex = rowInfo.index + 1\n}","html":true,"align":"right","headerStyle":{"font-weight":"normal"}}],"defaultPageSize":10,"showPageSizeOptions":false,"pageSizeOptions":[10,25,50,100],"paginationType":"numbers","showPagination":true,"showPageInfo":true,"minRows":1,"highlight":true,"compact":true,"height":"auto","theme":{"color":"#333333","backgroundColor":"#FFFFFF","stripedColor":"rgba(128,128,128,0.05)","style":{"fontFamily":"system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif"},"tableStyle":{"borderTopStyle":"solid","borderTopWidth":"2px","borderTopColor":"#D3D3D3"},"headerStyle":{"borderBottomStyle":"solid","borderBottomWidth":"2px","borderBottomColor":"#D3D3D3"}},"elementId":"rlvcmetfyu","dataKey":"423b61bd9dcf45a036c15d2c82fb17cc"},"children":[]},"class":"reactR_markup"},"evals":["tag.attribs.columns.0.style","tag.attribs.columns.1.style","tag.attribs.columns.2.style"],"jsHooks":[]}</script>
</div>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>df_pregnancy <span class="sc">|&gt;</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year) <span class="sc">|&gt;</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">count =</span> <span class="fu">n</span>(), <span class="at">volume =</span> <span class="fu">sum</span>(use))<span class="sc">|&gt;</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(year, (volume<span class="sc">/</span><span class="dv">1000</span>))) <span class="sc">+</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()<span class="sc">+</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Total pregnancy code use in HES"</span>, <span class="at">x =</span> <span class="st">"Year"</span>, <span class="at">y=</span> <span class="st">"Use in thousands"</span>) <span class="sc">+</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="fu">min</span>(df_pregnancy<span class="sc">$</span>year), <span class="fu">max</span>(df_pregnancy<span class="sc">$</span>year), <span class="at">by =</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="icd10_files/figure-html/pregnancy-tabs-2-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Finally, we examined the most frequently used codes, and their change over time. This was to establish why the rate of reporting in HES doubles in 2022 and 2023. Code Z370(“single live birth) was introduced in 2022 and has high-volume. It’s removal from HES partially reduced the difference pre-2022 and 2022-20223. Further such code, but to lesser volume is Z352 (”Supervision of pregnancy with other poor reproductive or obstetric history”). This code has some earlier usage but of smaller volume.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># df_pregnancy |&gt;</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">#slice_max(use, by = year, n = 5)|&gt;</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">#select(code, diagnosis, use, year)</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>df_pregnancy <span class="sc">|&gt;</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(use, <span class="at">by =</span> year, <span class="at">n =</span> <span class="dv">10</span>)<span class="sc">|&gt;</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(prop))<span class="sc">|&gt;</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(year) <span class="sc">|&gt;</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">values_from =</span> use, <span class="at">names_from =</span> year)<span class="sc">|&gt;</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>() <span class="sc">|&gt;</span> </span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sub_missing</span>(</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">missing_text =</span> <span class="st">"--"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="mtevvahwdf" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#mtevvahwdf table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#mtevvahwdf thead, #mtevvahwdf tbody, #mtevvahwdf tfoot, #mtevvahwdf tr, #mtevvahwdf td, #mtevvahwdf th {
  border-style: none;
}

#mtevvahwdf p {
  margin: 0;
  padding: 0;
}

#mtevvahwdf .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#mtevvahwdf .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#mtevvahwdf .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#mtevvahwdf .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#mtevvahwdf .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#mtevvahwdf .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#mtevvahwdf .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#mtevvahwdf .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#mtevvahwdf .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#mtevvahwdf .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#mtevvahwdf .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#mtevvahwdf .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#mtevvahwdf .gt_spanner_row {
  border-bottom-style: hidden;
}

#mtevvahwdf .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#mtevvahwdf .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#mtevvahwdf .gt_from_md > :first-child {
  margin-top: 0;
}

#mtevvahwdf .gt_from_md > :last-child {
  margin-bottom: 0;
}

#mtevvahwdf .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#mtevvahwdf .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#mtevvahwdf .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#mtevvahwdf .gt_row_group_first td {
  border-top-width: 2px;
}

#mtevvahwdf .gt_row_group_first th {
  border-top-width: 2px;
}

#mtevvahwdf .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#mtevvahwdf .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#mtevvahwdf .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#mtevvahwdf .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#mtevvahwdf .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#mtevvahwdf .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#mtevvahwdf .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#mtevvahwdf .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#mtevvahwdf .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#mtevvahwdf .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#mtevvahwdf .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#mtevvahwdf .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#mtevvahwdf .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#mtevvahwdf .gt_left {
  text-align: left;
}

#mtevvahwdf .gt_center {
  text-align: center;
}

#mtevvahwdf .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#mtevvahwdf .gt_font_normal {
  font-weight: normal;
}

#mtevvahwdf .gt_font_bold {
  font-weight: bold;
}

#mtevvahwdf .gt_font_italic {
  font-style: italic;
}

#mtevvahwdf .gt_super {
  font-size: 65%;
}

#mtevvahwdf .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#mtevvahwdf .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#mtevvahwdf .gt_indent_1 {
  text-indent: 5px;
}

#mtevvahwdf .gt_indent_2 {
  text-indent: 10px;
}

#mtevvahwdf .gt_indent_3 {
  text-indent: 15px;
}

#mtevvahwdf .gt_indent_4 {
  text-indent: 20px;
}

#mtevvahwdf .gt_indent_5 {
  text-indent: 25px;
}

#mtevvahwdf .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#mtevvahwdf div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="header gt_col_headings">
<th id="code" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">code</th>
<th id="diagnosis" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">diagnosis</th>
<th id="2013" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">2013</th>
<th id="2014" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">2014</th>
<th id="2015" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">2015</th>
<th id="2016" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">2016</th>
<th id="2017" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">2017</th>
<th id="2018" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">2018</th>
<th id="2019" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">2019</th>
<th id="2020" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">2020</th>
<th id="2021" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">2021</th>
<th id="2022" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">2022</th>
<th id="2023" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">2023</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers="code">Z380</td>
<td class="gt_row gt_left" headers="diagnosis">Singleton, born in hospital</td>
<td class="gt_row gt_right" headers="2013">642154</td>
<td class="gt_row gt_right" headers="2014">620064</td>
<td class="gt_row gt_right" headers="2015">613133</td>
<td class="gt_row gt_right" headers="2016">623748</td>
<td class="gt_row gt_right" headers="2017">618020</td>
<td class="gt_row gt_right" headers="2018">604573</td>
<td class="gt_row gt_right" headers="2019">577573</td>
<td class="gt_row gt_right" headers="2020">570735</td>
<td class="gt_row gt_right" headers="2021">543789</td>
<td class="gt_row gt_right" headers="2022">563009</td>
<td class="gt_row gt_right" headers="2023">533116</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="code">O701</td>
<td class="gt_row gt_left" headers="diagnosis">Second degree perineal laceration during delivery</td>
<td class="gt_row gt_right" headers="2013">161643</td>
<td class="gt_row gt_right" headers="2014">159178</td>
<td class="gt_row gt_right" headers="2015">–</td>
<td class="gt_row gt_right" headers="2016">164741</td>
<td class="gt_row gt_right" headers="2017">161224</td>
<td class="gt_row gt_right" headers="2018">158027</td>
<td class="gt_row gt_right" headers="2019">153689</td>
<td class="gt_row gt_right" headers="2020">149461</td>
<td class="gt_row gt_right" headers="2021">138397</td>
<td class="gt_row gt_right" headers="2022">138929</td>
<td class="gt_row gt_right" headers="2023">125340</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="code">O700</td>
<td class="gt_row gt_left" headers="diagnosis">First degree perineal laceration during delivery</td>
<td class="gt_row gt_right" headers="2013">96686</td>
<td class="gt_row gt_right" headers="2014">92157</td>
<td class="gt_row gt_right" headers="2015">90267</td>
<td class="gt_row gt_right" headers="2016">92992</td>
<td class="gt_row gt_right" headers="2017">95906</td>
<td class="gt_row gt_right" headers="2018">95341</td>
<td class="gt_row gt_right" headers="2019">92768</td>
<td class="gt_row gt_right" headers="2020">88066</td>
<td class="gt_row gt_right" headers="2021">81122</td>
<td class="gt_row gt_right" headers="2022">–</td>
<td class="gt_row gt_right" headers="2023">–</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="code">O721</td>
<td class="gt_row gt_left" headers="diagnosis">Other immediate postpartum haemorrhage</td>
<td class="gt_row gt_right" headers="2013">83814</td>
<td class="gt_row gt_right" headers="2014">79124</td>
<td class="gt_row gt_right" headers="2015">82712</td>
<td class="gt_row gt_right" headers="2016">93481</td>
<td class="gt_row gt_right" headers="2017">101828</td>
<td class="gt_row gt_right" headers="2018">109560</td>
<td class="gt_row gt_right" headers="2019">116952</td>
<td class="gt_row gt_right" headers="2020">123259</td>
<td class="gt_row gt_right" headers="2021">126659</td>
<td class="gt_row gt_right" headers="2022">134963</td>
<td class="gt_row gt_right" headers="2023">132600</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="code">O342</td>
<td class="gt_row gt_left" headers="diagnosis">Maternal care due to uterine scar from previous surgery</td>
<td class="gt_row gt_right" headers="2013">63651</td>
<td class="gt_row gt_right" headers="2014">64760</td>
<td class="gt_row gt_right" headers="2015">67414</td>
<td class="gt_row gt_right" headers="2016">74876</td>
<td class="gt_row gt_right" headers="2017">78285</td>
<td class="gt_row gt_right" headers="2018">81794</td>
<td class="gt_row gt_right" headers="2019">83012</td>
<td class="gt_row gt_right" headers="2020">85783</td>
<td class="gt_row gt_right" headers="2021">–</td>
<td class="gt_row gt_right" headers="2022">99926</td>
<td class="gt_row gt_right" headers="2023">104322</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="code">O800</td>
<td class="gt_row gt_left" headers="diagnosis">Spontaneous vertex delivery</td>
<td class="gt_row gt_right" headers="2013">63632</td>
<td class="gt_row gt_right" headers="2014">55319</td>
<td class="gt_row gt_right" headers="2015">49478</td>
<td class="gt_row gt_right" headers="2016">45191</td>
<td class="gt_row gt_right" headers="2017">–</td>
<td class="gt_row gt_right" headers="2018">–</td>
<td class="gt_row gt_right" headers="2019">–</td>
<td class="gt_row gt_right" headers="2020">–</td>
<td class="gt_row gt_right" headers="2021">–</td>
<td class="gt_row gt_right" headers="2022">–</td>
<td class="gt_row gt_right" headers="2023">–</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="code">O680</td>
<td class="gt_row gt_left" headers="diagnosis">Labour and delivery complicated by fetal heart rate anomaly</td>
<td class="gt_row gt_right" headers="2013">59653</td>
<td class="gt_row gt_right" headers="2014">59512</td>
<td class="gt_row gt_right" headers="2015">61852</td>
<td class="gt_row gt_right" headers="2016">61243</td>
<td class="gt_row gt_right" headers="2017">59990</td>
<td class="gt_row gt_right" headers="2018">59061</td>
<td class="gt_row gt_right" headers="2019">60043</td>
<td class="gt_row gt_right" headers="2020">59927</td>
<td class="gt_row gt_right" headers="2021">–</td>
<td class="gt_row gt_right" headers="2022">–</td>
<td class="gt_row gt_right" headers="2023">–</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="code">O688</td>
<td class="gt_row gt_left" headers="diagnosis">Labour and delivery complicated by other evidence of fetal stress</td>
<td class="gt_row gt_right" headers="2013">50781</td>
<td class="gt_row gt_right" headers="2014">50211</td>
<td class="gt_row gt_right" headers="2015">51823</td>
<td class="gt_row gt_right" headers="2016">52360</td>
<td class="gt_row gt_right" headers="2017">48840</td>
<td class="gt_row gt_right" headers="2018">–</td>
<td class="gt_row gt_right" headers="2019">–</td>
<td class="gt_row gt_right" headers="2020">45255</td>
<td class="gt_row gt_right" headers="2021">46132</td>
<td class="gt_row gt_right" headers="2022">–</td>
<td class="gt_row gt_right" headers="2023">–</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="code">O631</td>
<td class="gt_row gt_left" headers="diagnosis">Prolonged second stage (of labour)</td>
<td class="gt_row gt_right" headers="2013">43518</td>
<td class="gt_row gt_right" headers="2014">–</td>
<td class="gt_row gt_right" headers="2015">39582</td>
<td class="gt_row gt_right" headers="2016">–</td>
<td class="gt_row gt_right" headers="2017">–</td>
<td class="gt_row gt_right" headers="2018">–</td>
<td class="gt_row gt_right" headers="2019">–</td>
<td class="gt_row gt_right" headers="2020">–</td>
<td class="gt_row gt_right" headers="2021">–</td>
<td class="gt_row gt_right" headers="2022">–</td>
<td class="gt_row gt_right" headers="2023">–</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="code">O469</td>
<td class="gt_row gt_left" headers="diagnosis">Antepartum haemorrhage, unspecified</td>
<td class="gt_row gt_right" headers="2013">40545</td>
<td class="gt_row gt_right" headers="2014">–</td>
<td class="gt_row gt_right" headers="2015">39858</td>
<td class="gt_row gt_right" headers="2016">–</td>
<td class="gt_row gt_right" headers="2017">–</td>
<td class="gt_row gt_right" headers="2018">–</td>
<td class="gt_row gt_right" headers="2019">–</td>
<td class="gt_row gt_right" headers="2020">–</td>
<td class="gt_row gt_right" headers="2021">–</td>
<td class="gt_row gt_right" headers="2022">–</td>
<td class="gt_row gt_right" headers="2023">–</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="code">O268</td>
<td class="gt_row gt_left" headers="diagnosis">Other specified pregnancy-related conditions</td>
<td class="gt_row gt_right" headers="2013">–</td>
<td class="gt_row gt_right" headers="2014">132119</td>
<td class="gt_row gt_right" headers="2015">–</td>
<td class="gt_row gt_right" headers="2016">–</td>
<td class="gt_row gt_right" headers="2017">–</td>
<td class="gt_row gt_right" headers="2018">121522</td>
<td class="gt_row gt_right" headers="2019">–</td>
<td class="gt_row gt_right" headers="2020">–</td>
<td class="gt_row gt_right" headers="2021">–</td>
<td class="gt_row gt_right" headers="2022">124985</td>
<td class="gt_row gt_right" headers="2023">148636</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="code">O368</td>
<td class="gt_row gt_left" headers="diagnosis">Maternal care for other specified fetal problems</td>
<td class="gt_row gt_right" headers="2013">–</td>
<td class="gt_row gt_right" headers="2014">116439</td>
<td class="gt_row gt_right" headers="2015">–</td>
<td class="gt_row gt_right" headers="2016">–</td>
<td class="gt_row gt_right" headers="2017">–</td>
<td class="gt_row gt_right" headers="2018">193293</td>
<td class="gt_row gt_right" headers="2019">200999</td>
<td class="gt_row gt_right" headers="2020">–</td>
<td class="gt_row gt_right" headers="2021">–</td>
<td class="gt_row gt_right" headers="2022">234467</td>
<td class="gt_row gt_right" headers="2023">246569</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="code">O681</td>
<td class="gt_row gt_left" headers="diagnosis">Labour and delivery complicated by meconium in amniotic fluid</td>
<td class="gt_row gt_right" headers="2013">–</td>
<td class="gt_row gt_right" headers="2014">–</td>
<td class="gt_row gt_right" headers="2015">37595</td>
<td class="gt_row gt_right" headers="2016">–</td>
<td class="gt_row gt_right" headers="2017">–</td>
<td class="gt_row gt_right" headers="2018">–</td>
<td class="gt_row gt_right" headers="2019">–</td>
<td class="gt_row gt_right" headers="2020">–</td>
<td class="gt_row gt_right" headers="2021">–</td>
<td class="gt_row gt_right" headers="2022">–</td>
<td class="gt_row gt_right" headers="2023">–</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="code">O244</td>
<td class="gt_row gt_left" headers="diagnosis">Diabetes mellitus arising in pregnancy</td>
<td class="gt_row gt_right" headers="2013">–</td>
<td class="gt_row gt_right" headers="2014">–</td>
<td class="gt_row gt_right" headers="2015">–</td>
<td class="gt_row gt_right" headers="2016">47700</td>
<td class="gt_row gt_right" headers="2017">55161</td>
<td class="gt_row gt_right" headers="2018">62024</td>
<td class="gt_row gt_right" headers="2019">67102</td>
<td class="gt_row gt_right" headers="2020">–</td>
<td class="gt_row gt_right" headers="2021">76370</td>
<td class="gt_row gt_right" headers="2022">93888</td>
<td class="gt_row gt_right" headers="2023">98462</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="code">O365</td>
<td class="gt_row gt_left" headers="diagnosis">Maternal care for poor fetal growth</td>
<td class="gt_row gt_right" headers="2013">–</td>
<td class="gt_row gt_right" headers="2014">–</td>
<td class="gt_row gt_right" headers="2015">–</td>
<td class="gt_row gt_right" headers="2016">45859</td>
<td class="gt_row gt_right" headers="2017">52401</td>
<td class="gt_row gt_right" headers="2018">–</td>
<td class="gt_row gt_right" headers="2019">–</td>
<td class="gt_row gt_right" headers="2020">–</td>
<td class="gt_row gt_right" headers="2021">–</td>
<td class="gt_row gt_right" headers="2022">–</td>
<td class="gt_row gt_right" headers="2023">–</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="code">O992</td>
<td class="gt_row gt_left" headers="diagnosis">Endocrine, nutritional and metabolic diseases complicating pregnancy, childbirth and the puerperium</td>
<td class="gt_row gt_right" headers="2013">–</td>
<td class="gt_row gt_right" headers="2014">–</td>
<td class="gt_row gt_right" headers="2015">–</td>
<td class="gt_row gt_right" headers="2016">–</td>
<td class="gt_row gt_right" headers="2017">54284</td>
<td class="gt_row gt_right" headers="2018">66626</td>
<td class="gt_row gt_right" headers="2019">–</td>
<td class="gt_row gt_right" headers="2020">–</td>
<td class="gt_row gt_right" headers="2021">–</td>
<td class="gt_row gt_right" headers="2022">97462</td>
<td class="gt_row gt_right" headers="2023">108362</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="code">Z352</td>
<td class="gt_row gt_left" headers="diagnosis">Supervision of pregnancy with other poor reproductive or obstetric history</td>
<td class="gt_row gt_right" headers="2013">–</td>
<td class="gt_row gt_right" headers="2014">–</td>
<td class="gt_row gt_right" headers="2015">–</td>
<td class="gt_row gt_right" headers="2016">–</td>
<td class="gt_row gt_right" headers="2017">–</td>
<td class="gt_row gt_right" headers="2018">–</td>
<td class="gt_row gt_right" headers="2019">59096</td>
<td class="gt_row gt_right" headers="2020">–</td>
<td class="gt_row gt_right" headers="2021">–</td>
<td class="gt_row gt_right" headers="2022">83013</td>
<td class="gt_row gt_right" headers="2023">89744</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="code">O998</td>
<td class="gt_row gt_left" headers="diagnosis">Other specified diseases and conditions complicating pregnancy, childbirth and the puerperium</td>
<td class="gt_row gt_right" headers="2013">–</td>
<td class="gt_row gt_right" headers="2014">–</td>
<td class="gt_row gt_right" headers="2015">–</td>
<td class="gt_row gt_right" headers="2016">–</td>
<td class="gt_row gt_right" headers="2017">–</td>
<td class="gt_row gt_right" headers="2018">–</td>
<td class="gt_row gt_right" headers="2019">50447</td>
<td class="gt_row gt_right" headers="2020">–</td>
<td class="gt_row gt_right" headers="2021">–</td>
<td class="gt_row gt_right" headers="2022">–</td>
<td class="gt_row gt_right" headers="2023">–</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="code">O990</td>
<td class="gt_row gt_left" headers="diagnosis">Anaemia complicating pregnancy, childbirth and the puerperium</td>
<td class="gt_row gt_right" headers="2013">–</td>
<td class="gt_row gt_right" headers="2014">–</td>
<td class="gt_row gt_right" headers="2015">–</td>
<td class="gt_row gt_right" headers="2016">–</td>
<td class="gt_row gt_right" headers="2017">–</td>
<td class="gt_row gt_right" headers="2018">–</td>
<td class="gt_row gt_right" headers="2019">–</td>
<td class="gt_row gt_right" headers="2020">46698</td>
<td class="gt_row gt_right" headers="2021">–</td>
<td class="gt_row gt_right" headers="2022">–</td>
<td class="gt_row gt_right" headers="2023">–</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="code">O366</td>
<td class="gt_row gt_left" headers="diagnosis">Maternal care for excessive fetal growth</td>
<td class="gt_row gt_right" headers="2013">–</td>
<td class="gt_row gt_right" headers="2014">–</td>
<td class="gt_row gt_right" headers="2015">–</td>
<td class="gt_row gt_right" headers="2016">–</td>
<td class="gt_row gt_right" headers="2017">–</td>
<td class="gt_row gt_right" headers="2018">–</td>
<td class="gt_row gt_right" headers="2019">–</td>
<td class="gt_row gt_right" headers="2020">37263</td>
<td class="gt_row gt_right" headers="2021">39058</td>
<td class="gt_row gt_right" headers="2022">–</td>
<td class="gt_row gt_right" headers="2023">–</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="code">O420</td>
<td class="gt_row gt_left" headers="diagnosis">Premature rupture of membranes, onset of labour within 24 hours</td>
<td class="gt_row gt_right" headers="2013">–</td>
<td class="gt_row gt_right" headers="2014">–</td>
<td class="gt_row gt_right" headers="2015">–</td>
<td class="gt_row gt_right" headers="2016">–</td>
<td class="gt_row gt_right" headers="2017">–</td>
<td class="gt_row gt_right" headers="2018">–</td>
<td class="gt_row gt_right" headers="2019">–</td>
<td class="gt_row gt_right" headers="2020">35140</td>
<td class="gt_row gt_right" headers="2021">32409</td>
<td class="gt_row gt_right" headers="2022">–</td>
<td class="gt_row gt_right" headers="2023">–</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="code">Z351</td>
<td class="gt_row gt_left" headers="diagnosis">Supervision of pregnancy with history of abortive outcome</td>
<td class="gt_row gt_right" headers="2013">–</td>
<td class="gt_row gt_right" headers="2014">–</td>
<td class="gt_row gt_right" headers="2015">–</td>
<td class="gt_row gt_right" headers="2016">–</td>
<td class="gt_row gt_right" headers="2017">–</td>
<td class="gt_row gt_right" headers="2018">–</td>
<td class="gt_row gt_right" headers="2019">–</td>
<td class="gt_row gt_right" headers="2020">–</td>
<td class="gt_row gt_right" headers="2021">46068</td>
<td class="gt_row gt_right" headers="2022">–</td>
<td class="gt_row gt_right" headers="2023">–</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="code">P201</td>
<td class="gt_row gt_left" headers="diagnosis">Intrauterine hypoxia first noted during labour and delivery</td>
<td class="gt_row gt_right" headers="2013">–</td>
<td class="gt_row gt_right" headers="2014">–</td>
<td class="gt_row gt_right" headers="2015">–</td>
<td class="gt_row gt_right" headers="2016">–</td>
<td class="gt_row gt_right" headers="2017">–</td>
<td class="gt_row gt_right" headers="2018">–</td>
<td class="gt_row gt_right" headers="2019">–</td>
<td class="gt_row gt_right" headers="2020">–</td>
<td class="gt_row gt_right" headers="2021">33031</td>
<td class="gt_row gt_right" headers="2022">–</td>
<td class="gt_row gt_right" headers="2023">–</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="code">Z370</td>
<td class="gt_row gt_left" headers="diagnosis">Single live birth</td>
<td class="gt_row gt_right" headers="2013">–</td>
<td class="gt_row gt_right" headers="2014">–</td>
<td class="gt_row gt_right" headers="2015">–</td>
<td class="gt_row gt_right" headers="2016">–</td>
<td class="gt_row gt_right" headers="2017">–</td>
<td class="gt_row gt_right" headers="2018">–</td>
<td class="gt_row gt_right" headers="2019">–</td>
<td class="gt_row gt_right" headers="2020">–</td>
<td class="gt_row gt_right" headers="2021">–</td>
<td class="gt_row gt_right" headers="2022">558431</td>
<td class="gt_row gt_right" headers="2023">529460</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>df_pregnancy <span class="sc">|&gt;</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(code <span class="sc">!=</span> <span class="st">"Z370"</span>) <span class="sc">|&gt;</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year)<span class="sc">|&gt;</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">volume =</span> <span class="fu">sum</span>(use))<span class="sc">|&gt;</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(year, volume<span class="sc">/</span><span class="dv">1000</span>)) <span class="sc">+</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>()<span class="sc">+</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Total pregnancy code use in HES, excl. Z370"</span>, <span class="at">x =</span> <span class="st">"Year"</span>, <span class="at">y=</span> <span class="st">"Use in thousands"</span>) <span class="sc">+</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="fu">min</span>(df_pregnancy<span class="sc">$</span>year), <span class="fu">max</span>(df_pregnancy<span class="sc">$</span>year), <span class="at">by =</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="icd10_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>df_pregnancy <span class="sc">|&gt;</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>code <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Z370"</span>, <span class="st">"Z352"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year)<span class="sc">|&gt;</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">volume =</span> <span class="fu">sum</span>(use))<span class="sc">|&gt;</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(year, volume<span class="sc">/</span><span class="dv">1000</span>)) <span class="sc">+</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>()<span class="sc">+</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Total pregnancy code use in HES, excl. Z370 &amp; Z352"</span>, <span class="at">x =</span> <span class="st">"Year"</span>, <span class="at">y=</span> <span class="st">"Use in thousands"</span>) <span class="sc">+</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="fu">min</span>(df_pregnancy<span class="sc">$</span>year), <span class="fu">max</span>(df_pregnancy<span class="sc">$</span>year), <span class="at">by =</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="icd10_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="visual-exploration-of-pregnancy-codes" class="level2">
<h2 class="anchored" data-anchor-id="visual-exploration-of-pregnancy-codes">Visual exploration of pregnancy codes</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>df_pregnancy<span class="sc">|&gt;</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">diagnosis =</span> <span class="fu">ifelse</span>(prop <span class="sc">&gt;=</span> <span class="fl">0.001</span>, diagnosis, <span class="st">"Other"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year, diagnosis) <span class="sc">|&gt;</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">use =</span> <span class="fu">sum</span>(use), <span class="at">.groups =</span> <span class="st">"drop"</span>)<span class="sc">|&gt;</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="fu">as.factor</span>(year), </span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> use<span class="sc">/</span><span class="dv">1000</span>, </span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> forcats<span class="sc">::</span><span class="fu">fct_reorder</span>(diagnosis, use)</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>    ))<span class="sc">+</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>)<span class="sc">+</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()<span class="sc">+</span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Code use in thousands"</span>, <span class="at">x =</span> <span class="st">"Year"</span>, <span class="at">fill =</span> <span class="st">"Code"</span>,</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Cummulative use of the most common pregnancy codes"</span>) <span class="sc">+</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette =</span> <span class="dv">4</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="icd10_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="develop-an-app-in-r-shiny" class="level1">
<h1>Develop an app in R shiny</h1>
<div class="cell" data-shiny="true">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: shiny-app</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>ui <span class="ot">&lt;-</span> <span class="fu">fluidPage</span>(</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">titlePanel</span>(<span class="st">"ICD-10 Usage over time in HES"</span>),</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sidebarLayout</span>(</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sidebarPanel</span>(</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">textInput</span>(<span class="st">"icd10_code"</span>, </span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>                <span class="st">"Enter the ICD-10 code:"</span>, </span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>                <span class="at">value =</span> <span class="st">"A000"</span>),</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">sliderInput</span>(<span class="st">"year_range"</span>, </span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Select year range:"</span>,</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>                  <span class="at">min =</span> <span class="dv">2013</span>, </span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>                  <span class="at">max =</span> <span class="dv">2023</span>, </span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>                  <span class="at">value =</span> <span class="fu">c</span>(<span class="dv">2013</span>, <span class="dv">2023</span>), </span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>                  <span class="at">step =</span> <span class="dv">1</span>,</span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>                  <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mainPanel</span>(</span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a>      <span class="fu">textOutput</span>(<span class="st">"diagnosis"</span>),</span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a>      <span class="fu">tableOutput</span>(<span class="st">"usage_table"</span>),</span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a>      <span class="fu">plotOutput</span>(<span class="st">"usage_plot"</span>)</span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-29"><a href="#cb19-29" aria-hidden="true" tabindex="-1"></a>server <span class="ot">&lt;-</span> <span class="cf">function</span>(input, output) {</span>
<span id="cb19-30"><a href="#cb19-30" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-31"><a href="#cb19-31" aria-hidden="true" tabindex="-1"></a>  filtered_df <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="cb19-32"><a href="#cb19-32" aria-hidden="true" tabindex="-1"></a>    df <span class="sc">|&gt;</span></span>
<span id="cb19-33"><a href="#cb19-33" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(code <span class="sc">==</span> input<span class="sc">$</span>icd10_code,</span>
<span id="cb19-34"><a href="#cb19-34" aria-hidden="true" tabindex="-1"></a>             year  <span class="sc">&gt;=</span> input<span class="sc">$</span>year_range[<span class="dv">1</span>],</span>
<span id="cb19-35"><a href="#cb19-35" aria-hidden="true" tabindex="-1"></a>             year <span class="sc">&lt;=</span> input<span class="sc">$</span>year_range[<span class="dv">2</span>])</span>
<span id="cb19-36"><a href="#cb19-36" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb19-37"><a href="#cb19-37" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-38"><a href="#cb19-38" aria-hidden="true" tabindex="-1"></a>  output<span class="sc">$</span>diagnosis <span class="ot">&lt;-</span> <span class="fu">renderText</span>({</span>
<span id="cb19-39"><a href="#cb19-39" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (input<span class="sc">$</span>icd10_code <span class="sc">%in%</span> df<span class="sc">$</span>code) {</span>
<span id="cb19-40"><a href="#cb19-40" aria-hidden="true" tabindex="-1"></a>        <span class="fu">unique</span>(<span class="fu">filtered_df</span>()<span class="sc">$</span>diagnosis)</span>
<span id="cb19-41"><a href="#cb19-41" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb19-42"><a href="#cb19-42" aria-hidden="true" tabindex="-1"></a>      <span class="st">"No such ICD-10 code."</span></span>
<span id="cb19-43"><a href="#cb19-43" aria-hidden="true" tabindex="-1"></a>    }  </span>
<span id="cb19-44"><a href="#cb19-44" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb19-45"><a href="#cb19-45" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb19-46"><a href="#cb19-46" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-47"><a href="#cb19-47" aria-hidden="true" tabindex="-1"></a>  output<span class="sc">$</span>usage_table <span class="ot">&lt;-</span> <span class="fu">renderTable</span>({</span>
<span id="cb19-48"><a href="#cb19-48" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">nrow</span>(<span class="fu">filtered_df</span>())<span class="sc">&gt;</span><span class="dv">0</span>){</span>
<span id="cb19-49"><a href="#cb19-49" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filtered_df</span>()<span class="sc">|&gt;</span></span>
<span id="cb19-50"><a href="#cb19-50" aria-hidden="true" tabindex="-1"></a>        <span class="fu">select</span>(year, use)<span class="sc">|&gt;</span></span>
<span id="cb19-51"><a href="#cb19-51" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">as.integer</span>(year),</span>
<span id="cb19-52"><a href="#cb19-52" aria-hidden="true" tabindex="-1"></a>               <span class="at">use =</span> <span class="fu">as.integer</span>(use))<span class="sc">|&gt;</span></span>
<span id="cb19-53"><a href="#cb19-53" aria-hidden="true" tabindex="-1"></a>        <span class="fu">setNames</span>(<span class="fu">c</span>(<span class="st">"Year"</span>, <span class="st">"Annual Use"</span>))</span>
<span id="cb19-54"><a href="#cb19-54" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb19-55"><a href="#cb19-55" aria-hidden="true" tabindex="-1"></a>      <span class="st">"No data for the selected year range."</span></span>
<span id="cb19-56"><a href="#cb19-56" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb19-57"><a href="#cb19-57" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb19-58"><a href="#cb19-58" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-59"><a href="#cb19-59" aria-hidden="true" tabindex="-1"></a>  output<span class="sc">$</span>usage_plot <span class="ot">&lt;-</span> <span class="fu">renderPlot</span>({</span>
<span id="cb19-60"><a href="#cb19-60" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">nrow</span>(<span class="fu">filtered_df</span>()<span class="sc">&gt;</span><span class="dv">0</span>)) {</span>
<span id="cb19-61"><a href="#cb19-61" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ggplot</span>(<span class="fu">filtered_df</span>(), <span class="fu">aes</span>(</span>
<span id="cb19-62"><a href="#cb19-62" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> year, </span>
<span id="cb19-63"><a href="#cb19-63" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> use)) <span class="sc">+</span></span>
<span id="cb19-64"><a href="#cb19-64" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb19-65"><a href="#cb19-65" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb19-66"><a href="#cb19-66" aria-hidden="true" tabindex="-1"></a>        <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Year"</span>, <span class="at">y =</span> <span class="st">"Usage"</span>) <span class="sc">+</span></span>
<span id="cb19-67"><a href="#cb19-67" aria-hidden="true" tabindex="-1"></a>        <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> </span>
<span id="cb19-68"><a href="#cb19-68" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">seq</span>(input<span class="sc">$</span>year_range[<span class="dv">1</span>],</span>
<span id="cb19-69"><a href="#cb19-69" aria-hidden="true" tabindex="-1"></a>                                 input<span class="sc">$</span>year_range[<span class="dv">2</span>], </span>
<span id="cb19-70"><a href="#cb19-70" aria-hidden="true" tabindex="-1"></a>                                 <span class="dv">1</span>), </span>
<span id="cb19-71"><a href="#cb19-71" aria-hidden="true" tabindex="-1"></a>                           <span class="at">labels =</span> </span>
<span id="cb19-72"><a href="#cb19-72" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">seq</span>(input<span class="sc">$</span>year_range[<span class="dv">1</span>],</span>
<span id="cb19-73"><a href="#cb19-73" aria-hidden="true" tabindex="-1"></a>                                 input<span class="sc">$</span>year_range[<span class="dv">2</span>], </span>
<span id="cb19-74"><a href="#cb19-74" aria-hidden="true" tabindex="-1"></a>                                 <span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb19-75"><a href="#cb19-75" aria-hidden="true" tabindex="-1"></a>        <span class="fu">theme_minimal</span>()</span>
<span id="cb19-76"><a href="#cb19-76" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb19-77"><a href="#cb19-77" aria-hidden="true" tabindex="-1"></a>      <span class="st">""</span></span>
<span id="cb19-78"><a href="#cb19-78" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb19-79"><a href="#cb19-79" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb19-80"><a href="#cb19-80" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb19-81"><a href="#cb19-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-82"><a href="#cb19-82" aria-hidden="true" tabindex="-1"></a><span class="fu">shinyApp</span>(<span class="at">ui =</span> ui, <span class="at">server =</span> server)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p></p><div style="width: 100% ; height: 400px ; text-align: center; box-sizing: border-box; -moz-box-sizing: border-box; -webkit-box-sizing: border-box;" class="muted well">Shiny applications not supported in static R Markdown documents</div><p></p>
</div>
</div>
</section>
<section id="develop-an-app-in-python-streamlit" class="level1">
<h1>Develop an app in python streamlit</h1>
<p>First, run the following chunk to ensure the right environment for the app.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Install packages</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> subprocess</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sys</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>packages <span class="op">=</span> [<span class="st">'streamlit'</span>, <span class="st">'pandas'</span>, <span class="st">'matplotlib'</span>] </span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> install(package):</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>    subprocess.check_call([sys.executable, <span class="st">'-m'</span>, <span class="st">'pip'</span>, <span class="st">'install'</span>, package])</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> package <span class="kw">in</span> packages:</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>        <span class="bu">__import__</span>(package)</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">ImportError</span>:</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Installing </span><span class="sc">{</span>package<span class="sc">}</span><span class="ss">..."</span>)</span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>        install(package)</span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>package<span class="sc">}</span><span class="ss"> is already installed."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;module 'streamlit' from 'C:\\Users\\ATAMBO~1\\ANACON~1\\Lib\\site-packages\\streamlit\\__init__.py'&gt;
streamlit is already installed.
&lt;module 'pandas' from 'C:\\Users\\ATAMBO~1\\ANACON~1\\Lib\\site-packages\\pandas\\__init__.py'&gt;
pandas is already installed.
&lt;module 'matplotlib' from 'C:\\Users\\ATAMBO~1\\ANACON~1\\Lib\\site-packages\\matplotlib\\__init__.py'&gt;
matplotlib is already installed.</code></pre>
</div>
</div>
<p>Next run the following in your terminal:</p>
<p>```bash streamlit run icd10_app.py</p>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>